                    <div class="mb-3">
                        <label for="eventId" class="form-label">Event</label>
                        <select class="form-select" id="eventId" name="eventId" required>
                            <option value="">Select an event</option>
                            <% events.forEach(event => { %>
                                <option value="<%= event.id %>"><%= event.name %></option>
                            <% }); %>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="datetime" class="form-label">Match Date & Time</label>
                        <input type="datetime-local" 
                               class="form-control" 
                               id="datetime" 
                               name="datetime" 
                               value="<%= new Date().toISOString().slice(0, 16) %>"
                               required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Players</label>
                        <div id="playerSelection">
                            <% participants.forEach(participant => { %>
                                <div class="form-check">
                                    <input class="form-check-input" 
                                           type="checkbox" 
                                           name="players[]" 
                                           value="<%= participant.user_id %>" 
                                           id="player<%= participant.user_id %>">
                                    <label class="form-check-label" for="player<%= participant.user_id %>">
                                        <%= participant.username %>
                                    </label>
                                </div>
                            <% }); %>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Winner</label>
                        <select class="form-select" id="winnerId" name="winnerId" required>
                            <option value="">Select a winner</option>
                            <% participants.forEach(participant => { %>
                                <option value="<%= participant.user_id %>"><%= participant.username %></option>
                            <% }); %>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Loser</label>
                        <select class="form-select" id="loserId" name="loserId" required>
                            <option value="">Select a loser</option>
                            <% participants.forEach(participant => { %>
                                <option value="<%= participant.user_id %>"><%= participant.username %></option>
                            <% }); %>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Score</label>
                        <input type="text" class="form-control" id="score" name="score" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" id="notes" name="notes"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">Create Match</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.querySelector("form");
        const eventId = document.querySelector("#eventId");
        const datetime = document.querySelector("#datetime");
        const playerSelection = document.querySelector("#playerSelection");
        const winnerId = document.querySelector("#winnerId");
        const loserId = document.querySelector("#loserId");
        const score = document.querySelector("#score");
        const notes = document.querySelector("#notes");

        form.addEventListener("submit", function(event) {
            event.preventDefault();
            const formData = new FormData(form);
            const matchData = {
                eventId: eventId.value,
                datetime: datetime.value,
                players: Array.from(playerSelection.querySelectorAll("input[name='players[]']")).map(input => input.value),
                winnerId: winnerId.value,
                loserId: loserId.value,
                score: score.value,
                notes: notes.value
            };

            fetch("/matches", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(matchData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Match created successfully!");
                    window.location.href = "/matches";
                } else {
                    alert("Failed to create match. Please try again later.");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("An error occurred. Please try again later.");
            });
        });
    });
</script> 